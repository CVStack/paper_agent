# 프로젝트 상태 및 작업 인수인계 (Handover Note)

이 파일은 작업 환경을 이동(다른 PC 등)할 때 AI 에이전트에게 현재 프로젝트의 컨텍스트를 주입하기 위해 생성되었습니다.
새로운 환경에서 AI 세션을 시작할 때, 아래 내용을 복사하여 프롬프트로 입력하세요.

---
**[복사 시작 라인]**

## 1. 프로젝트 개요
이 프로젝트는 `paper_agent`로, 관심 있는 논문을 추적하여 신규 인용 논문을 자동으로 수집, 분류, 요약하는 AI 에이전트입니다.

## 2. 현재 시스템 설정
- **OS**: Windows (win32) 기반에서 개발됨.
- **주요 라이브러리**: `rapidfuzz`(유사도 분석), `arxiv`(정밀 검색), `google-generativeai`(LLM 연동), `aiohttp`(비동기 통신).
- **모델 설정** (`.env` 및 `config.py`):
    - 분류/구조화/1차판단: `gemini-1.5-flash`
    - 심층 요약: `gemini-1.5-pro`

## 3. 최근 수행한 대규모 리팩토링 (Refactoring Status)
최근 시스템의 효율성(비용 절감)과 정확도(품질 향상)를 위해 핵심 로직을 대폭 수정하였으며, 현재 `main` 브랜치에 반영되어 있습니다.

### A. Strict Mode (엄격 모드) 도입 (`src/agent.py`)
- **변경 전**: 1차 분류가 `uncertain`이면 2차 검증을 시도함.
- **변경 후**: 
    - 1차 분류(초록/스니펫 기반)에서 **`same_task`가 아니면 즉시 탈락(Filter out)**시킵니다.
    - 애매한 논문에 소요되는 리소스를 줄이고, 확실한 논문에 집중합니다.

### B. 고품질 심층 요약 파이프라인 (`src/agent.py`, `src/clients/gemini.py`)
- **변경 전**: `same_task`로 분류되어도 본문이 없어서 초록만으로 요약하는 경우가 있었음.
- **변경 후**:
    - `same_task`로 1차 통과한 논문은 **무조건 PDF 본문을 다운로드하고 구조화**합니다.
    - 확보된 `full_text`를 `summarize_with_gemini` 함수에 전달합니다.
    - 프롬프트(`prompts/summary_prompt.md`)가 본문 내용을 우선적으로 반영하도록 수정되었습니다.

### C. ArXiv 검색 정확도 대폭 개선 (`src/processing/document_parser.py`)
- **문제점**: 제목만으로 검색 시 ArXiv API가 엉뚱한 논문을 반환하는 경우 발생.
- **해결책**:
    - **복합 쿼리**: `au:{1저자_성} AND ti:{정제된_제목}` 형태의 쿼리를 사용.
    - **이중 검증**: 검색 결과에 대해 `제목 유사도(Fuzzy Match)`와 `저자 일치 여부`를 교차 검증하여 정확한 PDF만 확보합니다.

### D. 기타 개선 사항
- **서베이 필터링**: 제목이나 메타데이터에 "Survey", "Review" 등이 포함되면 처리를 건너뜁니다.
- **버그 수정**: `gemini-1.5-flash-latest` 등 지원 중단된 모델명 수정, 프롬프트 포맷팅(`{}`) 오류 수정.

## 4. 현재 진행 상황 및 남은 과제 (To-Do List)
현재 코드는 구현이 완료된 상태이며, 실제 동작 검증이 필요합니다.

1.  **[Priority] 1차 분류 로직 검증**: Strict Mode가 너무 엄격해서 중요한 논문을 놓치지 않는지 테스트 필요.
2.  **Summary 로직 검증**: 실제 PDF 본문이 요약 결과물(Markdown)에 디테일하게 반영되는지 확인 필요.
3.  **시각화 도구 구현**: 로그 텍스트만으로는 파악하기 힘든 에이전트의 판단 흐름(Filter -> Pass -> Summary)을 시각화하는 코드 구현 필요.

**요청:** 위 내용을 바탕으로 프로젝트 컨텍스트를 파악하고, 다음 작업인 **"1차 분류 로직 검증"**부터 지원을 이어서 진행해주세요.

**[복사 종료 라인]**
